<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>mario</title>
  <meta name="author" content="">
  <style>
  html, body{
   width:  100%;
   height: 100%;
   margin:0;
   overflow: hidden;
  }
  </style>
</head>

<body>
    <div style = "text-align:center;">
        <canvas id="canvas"></canvas>
    </div>
    <script>
        var cvs = document.getElementById("canvas");
        var ctx = cvs.getContext("2d");
        ctx.canvas.width  = window.innerWidth;
        ctx.canvas.height = window.innerHeight;
        document.addEventListener("keydown",keyPush);
        document.addEventListener("keyup",keyUp);
        gameInterval = setInterval(game,1000/10);

        var mario= new Image();
        var mario_flip= new Image();
        var bg= new Image();
        mario.src = "assets/mario/smb2_heroes_sheet.png";
        mario_flip.src = "assets/mario/smb2_heroes_sheet_flipped.png";
        bg.src = "assets/mario/bg.png";

        m_w = 18;
        m_h = 27;
        l_w = 16; // luigi width
        l_h = 32;
        hori_sp = 14; // horizontal spacing
        m_vert_sp = 24; //mario vertical spacing
        l_vert_sp = 82; //luigi vertical spacing
        scale_ratio = 4;
        ground_height = 75;
        xpos = cvs.width/2-25
        ypos = cvs.height-scale_ratio*m_h-cvs.height*8/100;

        action = 0;
        /* standing : 0
        running left: 1
        running right: 2
        jumping: 3
        */

        function sample_print_sprites(){
            x = 0;
            y = 10;
          for(var i=0;i<10;i++){
              ctx.drawImage(mario, 16*i+14*i, m_vert_sp, w_m, h_m, x+w_m, y, w_m, h_m);
              x = x+w_m;
          }

          //Luigi
            x=0;
            y=50;
          for(var i=0;i<10;i++){
              ctx.drawImage(mario, 16*i+14*i, l_vert_sp, w_l, h_l, x+w+l, y, w+l, h_l+5);
              x = x+w_l;
          }
        }

        frame = 0
        //drawImage(image, x inside image, y ' ', width to crop, height ' ', x on canvas, y ' ', width on canvas, height ' ')
        function game(){
          ctx.drawImage(bg, 0, 0, cvs.width, cvs.height);
          draw_sprite()
        }

        function draw_sprite(){
            image = mario;
            console.log(action);
            if(action==0){
                frame=1
            }
            else if(action==1){
                frame = frame==3?4:3;
            }
            else if(action==2){
                frame = frame==10?11:10;
                image = mario_flip;
            }
            console.log(image)
            ctx.drawImage(image, 
              (16*frame+14*frame)-4, 
              m_vert_sp, 
              m_w+4, 
              m_h, 
              xpos, 
              ypos, 
              scale_ratio*(m_w+4), 
              scale_ratio*m_h);
        }


        map=[]
        function keyPush(evt){
            evt = evt || event;
            map[evt.keyCode] = evt.type == "keydown";
            for(i=37;i<=40;i++){
                if(map[i]){
                    switch(i){
                    /* 37->Left; 38-> Up; 39-> Right; 40->Down */
                        case 37:
                            xpos=xpos-15;
                            action=1;
                            break;
                        case 39:
                            xpos=xpos+15;
                            action=2;
                            break;
                        case 40:
                            action=0;
                            break;
                    }
                }
            }
        }

        function keyUp(evt){
                evt = evt || event;
                map[evt.keyCode] = false;
                action = 0;
        }

    </script>
</body>
</html>
